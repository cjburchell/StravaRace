<div ng-controller="racePannelControler<%= race.doc._id%>">
<div ng-class="race.value.participant.rank | rankToPannelType" >
    <div class="panel-heading">
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                <a href="/race/details/<%= race.doc._id%>"><h4><%= race.doc.name%></h4></a>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                <h4 style="text-align: right"><%if(race.doc.state === 'upcoming'){%>
                    {{ race.doc.startsIn | secondsToCountdown}}
                    <%}%>

                    <%if(race.doc.state === 'in_progress'){%>
                    {{ race.doc.timeLeft | secondsToCountdown}}
                    <%}%>
                </h4>
            </div>
        </div>
    </div>
    <div class="panel-body">
        <%if(race.doc.state === "upcoming"){%>
            <h3>{{race.doc.totalDistance/1000 | number : 2}}km</h3>
        <h5><%= race.doc.stages.length %> Stages</h5>
        <%}else{%>
            <%if(race.value.participant.stagesComplete === race.value.participant.results.length){ %>
            <h3 class="rank"><% if(race.value.participant.rank && race.value.participant.rank<=3){%><i class="fa fa-trophy"></i> <%}%>Rank: <%= race.value.participant.rank%>/<%= race.value.participant.out_of%></h3>
        <%}else{%>
        <h3>Stages: <%= race.value.participant.stagesComplete%>/<%= race.value.participant.results.length%></h3>
        <%}%>
            <h5>Total Time: {{race.value.participant.time | secondsToTime }}</h5>
        <%}%>
    </div>
</div>
</div>

<script type="text/javascript">

    $app.controller('racePannelControler<%= race.doc._id%>', function($scope) {
        $scope.race = <%- JSON.stringify(race) %>;
    });

</script>